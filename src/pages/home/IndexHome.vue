<script setup lang="ts">
import { useRoomStore } from '@/stores/room';
import type { PokerRoomConfig } from '@/utils/interface';
import LocalUtil from '@/utils/LocalUtil';
import { onMounted, ref, watch } from 'vue';
import { useRouter } from 'vue-router';
import RoomListBtn from './RoomListBtn.vue'
import api from '@/api/api';
import { useRecordStore } from '@/stores/record';



const router = useRouter()
const roomStore = useRoomStore()
const createRoom = () => {
  router.push('/create-game')
}

const roomId = ref("")
const opLength = 6


watch(roomId, (newRoomId) => {
  if (newRoomId.length >= opLength) {
    console.log("达到了6位了");
    toRoom(newRoomId)
  }
})

const toRoom = (room: string) => {
  api.in_room(room).then((data) => {
    roomStore.roomId = room
    LocalUtil.setString(room, 'roomId')
    router.push('/game')
  }).catch((er) => {
    console.log(er);
    setTimeout(() => {

      roomId.value = ''
    }, 1000);
  })
}

const recordStore = useRecordStore()


</script>

<template>
  <div class="flex flex-col pos-relative items-center bg-[var(--my-bg)]">
    <div class="flex flex-row w-full justify-between  items-center pos-absolute top-0 z-9">
      <UserAvatr />
      <UserBalance class=" scale-90 mt-[-10px]" />
    </div>
    <van-swipe class="w-full  h-[180px]" :autoplay="3000" indicator-color="white">

      <van-swipe-item class="w-full" v-for="item in recordStore.bannerList">
        <van-image :src="item.image_url" class="w-full h-[180px] " alt="" srcset="" />
      </van-swipe-item>
    </van-swipe>

    <v-card style="background: var(--my-primary)" class="w-[96%] mb-2 pos-relative bg-[var(--my-primary)]!"
      subtitle="创建你的私人房间,邀请好友进入房间" title="私人房">
      <v-otp-input :length="opLength" v-model="roomId" max-width="88%" class="h-[55px]!"
        variant="solo-filled"></v-otp-input>
      <p class="text-[12px] text-[var(--my-cardSubText)] font-700 w-full text-center">输入房间号码,即可进入游戏房间～</p>

      <v-btn @click="createRoom" class="my-2 mx-[6%]" style="
              background: var(--my-buttonPrimaryBg) ;
              color: var(--my-buttonPrimaryText) ;
              border:  var(--my-buttonPrimaryBorder) ;
            " height="40" min-width="100" width="88%">
        <p class="text-[18px] font-bold">创建房间</p>
      </v-btn>

      <div class=" pos-absolute top-[-5px] right-2 ">
        <svg t="1751909773489" class="icon" viewBox="0 0 1401 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
          p-id="13090" width="80" height="80">
          <path
            d="M1081.487719 371.514386c-54.613333 0-105.633684 14.37193-150.186666 39.522807 4.311579 13.653333 8.623158 28.025263 11.497543 42.397193C983.04 427.564912 1030.467368 413.192982 1081.487719 413.192982c145.156491 0 263.006316 117.849825 263.006316 263.006316 0 145.156491-117.849825 263.006316-263.006316 263.006316-86.231579 0-163.121404-41.678596-210.548772-105.633684-7.904561 12.21614-17.246316 23.713684-25.869473 35.211228 56.050526 68.985263 141.563509 112.819649 237.136842 112.819649 168.870175 0 305.403509-136.533333 305.403509-305.403509-1.437193-168.151579-137.970526-304.684912-306.122106-304.684912z"
            fill="#F9D540" p-id="13091"></path>
          <path
            d="M467.806316 107.070877C217.734737 107.070877 15.090526 309.715088 15.090526 559.786667s202.644211 452.715789 452.71579 452.715789 452.715789-202.644211 452.715789-452.715789-202.644211-452.715789-452.715789-452.71579z m0 843.632281c-215.578947 0-390.197895-175.337544-390.197895-390.197895 0-215.578947 175.337544-390.197895 390.197895-390.197895 215.578947 0 390.197895 175.337544 390.197895 390.197895 0 214.860351-174.618947 390.197895-390.197895 390.197895z"
            fill="#FFD800" p-id="13092"></path>
          <path
            d="M1081.487719 897.527018c122.161404 0 221.327719-99.166316 221.32772-220.609123 0-122.161404-99.166316-221.327719-221.32772-221.32772-48.864561 0-94.13614 16.527719-130.784561 43.11579 2.874386 20.120702 4.311579 40.96 4.311579 61.799298 0 84.794386-21.557895 164.558596-60.362105 233.54386 38.804211 61.799298 107.789474 103.477895 186.835087 103.477895z m-15.090526-201.207018c-43.834386-14.37193-73.296842-35.211228-73.296842-74.734035 0-36.648421 25.150877-64.673684 68.985263-72.578246V510.203509h40.241404v35.929824c26.58807 0.718596 45.271579 7.185965 59.643508 13.653334L1149.754386 605.776842c-10.060351-5.030175-29.462456-14.37193-58.924912-14.37193-26.58807 0-35.211228 11.497544-35.211228 22.995088 0 12.934737 14.37193 22.276491 49.583158 34.492632 48.145965 17.246316 67.54807 39.522807 67.54807 76.889824 0 35.929825-25.150877 67.54807-71.859649 74.734035v41.678597H1059.929825v-38.804211c-27.306667-1.437193-53.894737-8.623158-68.985264-17.246316l12.216141-47.427368c17.246316 9.341754 40.96 17.964912 67.54807 17.964912 23.713684 0 39.522807-9.341754 39.522807-25.150877-0.718596-15.809123-13.653333-25.150877-43.834386-35.211228zM467.806316 232.106667c-181.086316 0-327.68 147.312281-327.68 327.68C140.126316 740.872982 287.438596 887.466667 467.806316 887.466667c181.086316 0 328.398596-147.312281 328.398596-327.68s-147.312281-327.68-328.398596-327.68z m28.025263 512.359298v62.517895h-59.643509v-57.48772c-40.241404-2.155789-79.764211-13.653333-102.759298-25.869473l17.964912-71.141053c25.150877 13.653333 61.080702 26.58807 100.603509 26.58807 35.211228 0 58.924912-13.653333 58.924912-37.367017 0-22.995088-19.402105-37.367018-64.673684-52.457544-64.673684-21.557895-109.226667-51.738947-109.226667-110.66386 0-53.894737 37.367018-95.573333 102.040702-107.789474v-57.487719h59.643509v53.176141c40.241404 1.437193 66.829474 10.060351 88.387368 20.120701l-17.964912 68.266667c-15.090526-7.185965-43.834386-20.839298-86.950175-20.839298-39.522807 0-51.738947 17.246316-51.738948 34.492631 0 19.402105 20.839298 32.336842 73.296842 51.738948 71.859649 25.150877 100.603509 58.924912 100.603509 113.538245-1.437193 53.17614-38.804211 99.166316-108.50807 110.66386z"
            fill="#FFB320" p-id="13093"></path>
          <path
            d="M1006.753684 349.237895c-95.573333 0-173.900351-77.608421-173.900351-173.900351 0-96.29193 77.608421-173.900351 173.900351-173.900351 96.29193 0 173.900351 77.608421 173.900351 173.900351 0 96.29193-77.608421 173.900351-173.900351 173.900351z m0-324.087018c-82.638596 0-150.186667 67.54807-150.186666 150.186667s67.54807 150.186667 150.186666 150.186667 150.186667-67.54807 150.186667-150.186667-67.54807-150.186667-150.186667-150.186667z"
            fill="#F9D540" p-id="13094"></path>
          <path
            d="M1006.753684 301.09193c69.70386 0 125.754386-56.769123 125.754386-125.754386 0-69.70386-56.769123-125.754386-125.754386-125.754386-69.70386 0-126.472982 56.769123-126.472982 125.754386 0.718596 69.70386 57.487719 125.754386 126.472982 125.754386z m-8.623158-114.256842c-25.150877-8.623158-41.678596-20.120702-41.678596-42.397193 0-20.839298 14.37193-36.648421 39.522807-41.678597V80.482807h22.995088v20.839298c15.090526 0.718596 25.869474 4.311579 33.774035 7.904562l-7.185965 26.58807c-5.748772-2.874386-16.527719-7.904561-33.774035-7.904562-15.090526 0-20.120702 6.467368-20.120702 12.934737 0 7.185965 7.904561 12.934737 28.025263 20.120702 28.025263 10.060351 38.804211 22.276491 38.804211 43.834386 0 20.839298-14.37193 38.085614-40.96 43.115789v23.713685h-22.995088V247.915789c-15.809123-0.718596-30.899649-5.030175-39.522807-10.06035l7.185965-27.306667c10.060351 5.030175 23.713684 10.060351 38.80421 10.060351 13.653333 0 22.276491-5.030175 22.276492-14.37193 0-8.623158-7.185965-13.653333-25.150878-19.402105z"
            fill="#FFB320" p-id="13095"></path>
        </svg>
      </div>
    </v-card>
    <RoomListBtn />


  </div>

</template>

<style scoped></style>
